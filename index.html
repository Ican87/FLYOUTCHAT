<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Flyâ€‘Out Chatroom</title>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>

  <!-- Basic styling -->
  <style>
    :root {
      --bg: #0a0a0a;
      --panel: #1d1d1d;
      --accent: #ff2d55;
      /* Path to background image (update as needed) */
      --bg-image: url('background.jpg');
      /* 0 = invisible, 1 = solid */
      --bg-opacity: 0.25;
    }

    * { box-sizing: border-box; }
    html, body {
      width: 100%; height: 100%; margin: 0;
      font-family: system-ui, sans-serif;
      background: var(--bg); color: #fafafa;
      overflow: hidden;
    }

    /* === Background === */
    body::before {
      content: ""; position: fixed; inset: 0; z-index: -1;
      background: var(--bg-image) center/cover no-repeat;
      opacity: var(--bg-opacity);
      pointer-events: none;
    }

    /* =============== Layout ================= */
    .screen { position: absolute; inset: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 1.25rem; transition: opacity 0.4s ease; }
    .hidden { opacity: 0; pointer-events: none; }

    input, button { padding: 0.75rem 1rem; border: none; border-radius: 0.75rem; font-size: 1rem; }
    input { background: var(--panel); color: #fff; width: 18rem; }
    input:focus { outline: 2px solid var(--accent); }

    button { background: var(--accent); color: #fff; cursor: pointer; transition: background 0.2s ease; }
    button:disabled { opacity: 0.4; cursor: not-allowed; }
    button:hover:not(:disabled) { filter: brightness(1.1); }

    /* Chat flyâ€‘out */
    #message-container { position: absolute; inset: 0; overflow: hidden; pointer-events: none; }
    .message { position: absolute; left: 50%; bottom: 0; transform: translateX(-50%); background: rgba(255,255,255,0.1); padding: 0.5rem 1rem; border-radius: 9999px; backdrop-filter: blur(6px); white-space: nowrap; animation: fly 7s linear forwards; }
    @keyframes fly { 0%{transform:translate(-50%,0) rotate(var(--rot)) translateX(0);opacity:1;} 100%{transform:translate(-50%,-120vh) rotate(var(--rot)) translateX(var(--dx));opacity:0;} }

    /* Composer */
    #composer { position: absolute; left: 50%; bottom: 2rem; transform: translateX(-50%); display: flex; gap: 0.75rem; }
    #composer input { flex: 1; width: 18rem; }

    /* Toast */
    #toast { position: fixed; top: 1rem; left: 50%; transform: translateX(-50%); background: var(--panel); padding: 0.5rem 1rem; border-radius: 0.5rem; opacity: 0; pointer-events: none; transition: opacity 0.3s ease; z-index: 9999; }
    #toast.show { opacity: 1; }
  </style>
</head>
<body>
  <section id="login-screen" class="screen">
    <h1>Flyâ€‘Out Chat</h1>
    <input id="nickname" placeholder="Nickname" />
    <input id="instagram" placeholder="@instagram" />
    <button id="verify-btn">Verify Instagram</button>
    <button id="login-btn" disabled>Enter Chat</button>
  </section>

  <section id="chat-screen" class="screen hidden">
    <div id="message-container"></div>
    <form id="composer">
      <input id="message-input" autocomplete="off" placeholder="Type a messageâ€¦" />
      <button type="submit">Send</button>
    </form>
  </section>

  <div id="toast"></div>

  <script>
    // === 1. Firebase config ===
    const firebaseConfig = {
      apiKey: "AIzaSyCLmsuZvBu526oiHtX2NNoqHoclZ7lMrt0",
  authDomain: "flyoutchat.firebaseapp.com",
  projectId: "flyoutchat",
  storageBucket: "flyoutchat.firebasestorage.app",
  messagingSenderId: "1032339038175",
  appId: "1:1032339038175:web:af095a595ede018b83ae6a",
  measurementId: "G-7D2LK5ST4C",
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // === 2. DOM refs ===
    const $ = (id) => document.getElementById(id);
    const loginScreen = $("login-screen");
    const chatScreen = $("chat-screen");
    const loginBtn = $("login-btn");
    const verifyBtn = $("verify-btn");
    const nicknameInput = $("nickname");
    const instagramInput = $("instagram");
    const messageInput = $("message-input");
    const composer = $("composer");
    const messageContainer = $("message-container");
    const toast = $("toast");

    const showToast = (msg, ms=3000) => { toast.textContent = msg; toast.classList.add("show"); setTimeout(()=>toast.classList.remove("show"), ms); };

    // === 3. Instagram pseudoâ€‘verification ===
    let verified = false;
    verifyBtn.addEventListener("click", () => {
      const ig = instagramInput.value.trim();
      if (!ig) { showToast("Masukkan username Instagram dulu"); return; }
      const url = `https://instagram.com/${ig.replace(/^@/,"")}`;
      const win = window.open(url, "_blank");
      if (!win) showToast("Popup diblokir â€” buka Instagram manual");
      setTimeout(() => {
        if (confirm("Sudah follow akun tersebut?")) markVerified();
        else showToast("Klik Verify lagi setelah follow");
      }, 2000);
    });
    const markVerified = () => { verified = true; verifyBtn.textContent = "âœ“ Verified"; verifyBtn.disabled = true; loginBtn.disabled = false; showToast("Instagram terverifikasi ðŸŽ‰"); };

    // === 4. Login ===
    loginBtn.addEventListener("click", () => {
      if (!verified) { showToast("Verifikasi IG dulu"); return; }
      const nick = nicknameInput.value.trim();
      if (!nick) { showToast("Nickname wajib"); return; }
      localStorage.setItem("nick", nick);
      loginScreen.classList.add("hidden");
      chatScreen.classList.remove("hidden");
      initChat(nick);
    });

    // === 5. Chat init ===
    function initChat(nick) {
      composer.addEventListener("submit", (e) => {
        e.preventDefault();
        const text = messageInput.value.trim();
        if (!text) return;
        messageInput.value = "";
        db.ref("messages").push({ nick, text, ts: Date.now() });
      });
      db.ref("messages").limitToLast(100).on("child_added", (snap) => {
        const { nick: sender, text } = snap.val();
        displayFlyout(sender, text);
      });
    }

    // === 6. Flyâ€‘out bubble ===
    function displayFlyout(nick, text) {
      const bubble = document.createElement("div");
      bubble.className = "message";
      bubble.textContent = `${nick}: ${text}`;
      const rot = Math.random()*60 - 30; // -30â€¦30Â°
      const dx = Math.random()*300 - 150;
      bubble.style.setProperty("--rot", `${rot}deg`);
      bubble.style.setProperty("--dx", `${dx}px`);
      messageContainer.appendChild(bubble);
      setTimeout(()=>bubble.remove(),7000);
    }
  </script>
</body>
</html>
